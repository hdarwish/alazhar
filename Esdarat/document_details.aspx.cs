using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;
using System.Text.RegularExpressions;

public partial class Esdarat_document_details : BasePage
{
    public int count_fields = 0;
    public String[] arr_divs = new String[20];

    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            int id = Convert.ToInt16(HttpUtility.HtmlEncode(Request.QueryString["id"]));
            Session["content_id"] = id.ToString();
            Session["content_type"] = "8";
            //Session["referred"] = "true";
            //HtmlGenericControl maindiv = (HtmlGenericControl)Page.Master.FindControl("leftUC11").FindControl("div_related");
            //maindiv.Visible = false;
          
           
            
            HiddenID.Value = id.ToString();
            fillmaterial();
            filltypes();
            filllang();
            //fillcheck_periods();
            View();

            if (Session["Lang"].ToString() == "en" || Session["Lang"].ToString() == "2" || Session["Lang"].ToString() == "fr" || Session["Lang"].ToString() == "3")
            {
                Div1.Attributes["class"] = "accordion_title_enfr";
                //Div2.Attributes["class"] = "accordion_body_enfr";
                tr_title.Attributes["class"] = "accordion_title_enfr";
                trothertitle.Attributes["class"] = "accordion_body_enfr";
                tr1.Attributes["class"] = "accordion_title_enfr";
                trpup.Attributes["class"] = "accordion_body_enfr";
                tr5.Attributes["class"] = "accordion_title_enfr";
                trcreater.Attributes["class"] = "accordion_body_enfr";
                tr6.Attributes["class"] = "accordion_title_enfr";
                trcreaterno.Attributes["class"] = "accordion_body_enfr";
                tr7.Attributes["class"] = "accordion_title_enfr";
                trdates.Attributes["class"] = "accordion_body_enfr";
                tr8.Attributes["class"] = "accordion_title_enfr";
                trsaveorg.Attributes["class"] = "accordion_body_enfr";
                tr9.Attributes["class"] = "accordion_title_enfr";
                trmaterial.Attributes["class"] = "accordion_body_enfr";
                tr10.Attributes["class"] = "accordion_title_enfr";
                trmadmon.Attributes["class"] = "accordion_body_enfr";
                tr11.Attributes["class"] = "accordion_title_enfr";
                trlang.Attributes["class"] = "accordion_body_enfr";
                tr12.Attributes["class"] = "accordion_title_enfr";
                tr112.Attributes["class"] = "accordion_body_enfr";
                tr13.Attributes["class"] = "accordion_title_enfr";
                trpages.Attributes["class"] = "accordion_body_enfr";
                tr14.Attributes["class"] = "accordion_title_enfr";
                trnotes.Attributes["class"] = "accordion_body_enfr";
            }

            //-------------------------clored the Divs-------------------------------------
            for (int y = 0; y < count_fields-1; y = y + 2)
            {
                if (Session["Lang"].ToString() == "en" || Session["Lang"].ToString() == "2" || Session["Lang"].ToString() == "fr" || Session["Lang"].ToString() == "3")
                {
                    changeDiv_cssClass(sender, e, arr_divs[y], "accordion_title_enfr2");
                    if (arr_divs[y + 1] != null)
                    {
                        changeDiv_cssClass(sender, e, arr_divs[y + 1], "accordion_title_enfr");
                    }
                }
                else
                {
                    changeDiv_cssClass(sender, e, arr_divs[y], "accordion_title2");
                    if (arr_divs[y + 1] != null)
                    {
                        changeDiv_cssClass(sender, e, arr_divs[y + 1], "accordion_title");
                    }
                }
            }

        }
    }
    private void filllang()
    {
        languages_DT obj = new languages_DT();
        DataTable lang_dt = languages_DB.SelectAll();

        drop_lang.DataSource = lang_dt;
        drop_lang.DataBind();
        ListItem litem = new ListItem("-- اختر اللغة  --", "0");
        drop_lang.Items.Insert(0, litem);
       
    }
    private void fillmaterial()
    {
       materials_DT obj_dt = new materials_DT();
        DataTable dt = materials_DB.SelectByContent_Type(8);
        drop_material.DataSource = dt;
        drop_material.DataBind();
        ListItem litem = new ListItem("-- اختر الشكل المادي --", "0");
        drop_material.Items.Insert(0, litem);
       
    }
    private void filltypes()
    {
        styles_DT obj_sdt = new styles_DT();
        DataTable style_dt = styles_DB.SelectByContent_Type(8);
        drop_docstype.DataSource = style_dt;
        drop_docstype.DataBind();
        ListItem litem = new ListItem("-- اختر مضمون الوثيقة --", "0");
        drop_docstype.Items.Insert(0, litem);
       
    }
    private void fillcheck_periods()
    {
        periods_DT obj = new periods_DT();
        DataTable per_dt = periods_DB.SelectAll();
        //chk_periods.DataSource = per_dt;
        //chk_periods.DataBind();
        //chk_periods.DataValueField = "id";
        // chk_periods.DataTextField = "title";

    }
    public void View()
    {
        int j = 0;
        documents_DT obj = new documents_DT();
        documents_details_DT obj_dt = new documents_details_DT();
        obj = documents_DB.SelectByID(CDataConverter.ConvertToInt(HiddenID.Value));
        obj_dt = documents_details_DB.SelectByID(CDataConverter.ConvertToInt(HiddenID.Value), menus_update.get_current_lang());

        if (obj != null)
        {
            if (obj.form_status != 12)
                Response.Redirect("~/Esdarat/list_document.aspx");
            else if ((Session["Lang"].ToString() == "en" || Session["Lang"].ToString() == "2") && obj.form_status_en != 12)
            {
                Response.Redirect("~/Esdarat/list_document.aspx");
            }
            else if ((Session["Lang"].ToString() == "fr" || Session["Lang"].ToString() == "3") && obj.form_status_fr != 12)
            {
                Response.Redirect("~/Esdarat/list_document.aspx");
            }
        }

        
        //------------------------------------------------------no 1-------------------------------------------------
        Labtitle.Text = obj_dt.title;
        //------------------------------------------------------no 2----------------------------------------------------------------------------

        if (obj_dt.FromDocumented != null && obj_dt.FromDocumented != "")
        {
            txt_othertitle.Text = obj_dt.FromDocumented;
            count_fields = count_fields + 1;
            arr_divs[j] = "tr_title";
            j = j + 1;
        }
        else
        { trothertitle.Visible = tr_title.Visible = false; }
        //------------------------------------------------------no 3----------------------------------------------------------------------------


        if (obj.publish_or_not.ToString() != "")
        {
            rad_publish.SelectedValue = obj.publish_or_not.ToString();
            lbl_rad_publish.Text = rad_publish.SelectedItem.Text;
            count_fields = count_fields + 1;
            arr_divs[j] = "tr1";
            j = j + 1;

        }
        else
        { tr1.Visible = trpup.Visible = false; }

        //--------------------------------------------------------------no 4---------------------------------------------------------------

        // txt_tags.Text = obj_dt.keywords;
        if (obj_dt.resource != null && obj_dt.resource.ToString() != "")
        {
            txt_creater.Text = obj_dt.resource;
            count_fields = count_fields + 1;
            arr_divs[j] = "tr5";
            j = j + 1;
        }
        else
        {
            trcreater.Visible = tr5.Visible = false;
        }
        //------------------------------------------------------no 5----------------------------------------------------------------------------

        if (obj.creater_no != null && obj.creater_no.ToString() != "")
        {
            txt_creater_no.Text = obj.creater_no;
            count_fields = count_fields + 1;
            arr_divs[j] = "tr6";
            j = j + 1;
        }
        else
        {
            trcreaterno.Visible = tr6.Visible = false;
        }
        //------------------------------------------------------no 6----------------------------------------------------------------------------

        if ((obj.publish_hdate == null || obj.publish_hdate.ToString() == "") && (obj.publish_date == null || obj.publish_date.ToString() == ""))
        { tr7.Visible = trdates.Visible = false; }
        else
        {
            count_fields = count_fields + 1;
            arr_divs[j] = "tr7";
            j = j + 1;
            txt_hdate.Text = obj.publish_hdate;
            txt_date.Text = obj.publish_date;
        }
        if (Session["Lang"].ToString() == "en" || Session["Lang"].ToString() == "2" || Session["Lang"].ToString() == "fr" || Session["Lang"].ToString() == "3")
        {
            Regex regex = new Regex("[ء-ي]+");
             if ((regex.IsMatch(obj.publish_hdate)) || regex.IsMatch(obj.publish_date))
             {
                 tr7.Visible = trdates.Visible = false;
             }
        }
        //------------------------------------------------------no 7-------------------------------------------------

        if (obj_dt.material_type != "")
        {
            if (obj_dt.material_type != null)
            {
                string id = obj_dt.material_type;
                drop_material.Items.FindByText(id).Selected = true;
            }
            lbl_drop_material.Text = drop_material.SelectedItem.Text;

        }
        if (drop_material.SelectedIndex == 0)
        { tr9.Visible = trmaterial.Visible = false; }
        else
        {
            count_fields = count_fields + 1;
            arr_divs[j] = "tr9";
            j = j + 1;
        }
        //------------------------------------------------------no 8-------------------------------------------------

        if (obj_dt.docs_type != "")
        {
            if (obj_dt.docs_type != null)
            {
                string id = obj_dt.docs_type;
                drop_docstype.Items.FindByText(id).Selected = true;
            }
            lbl_drop_docstype.Text = drop_docstype.SelectedItem.Text;

        }
        if (drop_docstype.SelectedIndex == 0)
        { tr10.Visible = trmadmon.Visible = false; }
        else
        {
            count_fields = count_fields + 1;
            arr_divs[j] = "tr10";
            j = j + 1;
        } 

        //------------------------------------------------------no 9-------------------------------------------------

        if (obj_dt.doc_lang != "")
        {
            if (obj_dt.doc_lang != null)
            {
                string id = obj_dt.doc_lang;
                drop_lang.Items.FindByText(id).Selected = true;


            }
            lbl_drop_lang.Text = drop_lang.SelectedItem.Text;
        }




        if (drop_lang.SelectedIndex == 0)
        { tr11.Visible = trlang.Visible = false; }
        else
        {
            count_fields = count_fields + 1;
            arr_divs[j] = "tr11";
            j = j + 1;
        }


 
        //---------------------------------------------------------------------------------------------------------------
        if (obj.large_image != "")
        {
            //link_pdf1.Visible = true;
            //link_pdf1.HRef = "~/images/esdarat/" + obj.large_image;
            HtmlAnchor link_pdf1 = (HtmlAnchor)Page.Master.FindControl("leftUC11").FindControl("link_pdf1");
            link_pdf1.HRef = "~/images/esdarat/" + obj.large_image;
            Label lbl_veiw = (Label)Page.Master.FindControl("leftUC11").FindControl("lbl_veiw");
            

            if (Session["Lang"].ToString() == "en" || Session["Lang"].ToString() == "2")
            {
                lbl_veiw.Text = "View the Document";
            }
            else if (Session["Lang"].ToString() == "fr" || Session["Lang"].ToString() == "3")
            {
                lbl_veiw.Text = "Voir Le Document";
            }
            else
            {
                lbl_veiw.Text = "عرض الوثيقة";
            }
        }
           
        else {
            HtmlGenericControl pdf_continer = (HtmlGenericControl)Page.Master.FindControl("leftUC11").FindControl("pdf_continer");
            pdf_continer.Visible = false; 
        }
        Image lcImage = (Image)Page.Master.FindControl("leftUC11").FindControl("Image1");
        if (obj.small_image != "")
        {
            //Image lcImage = (Image)Page.Master.FindControl("leftUC11").FindControl("Image1");
            lcImage.ImageUrl = "../images/esdarat/" + obj.small_image;
            //Image1.ImageUrl = "~/images/esdarat/" + obj.small_image;
        }
        else lcImage.ImageUrl = "../img/Icon-1.jpg";
        Label lclabel = (Label)Page.Master.FindControl("leftUC11").FindControl("content_txt");
        
        
        if (Session["Lang"].ToString() == "en" || Session["Lang"].ToString() == "2")
        {
            lclabel.Text = "Documents";
        }
        else if (Session["Lang"].ToString() == "fr" || Session["Lang"].ToString() == "3")
        {
            lclabel.Text = "Documents";
        }
        else
        {
            lclabel.Text = "الوثيقة";
        }


        ///////========================================================10=====================================================================================

        CheckBox1.Checked = obj_dt.docs_sum;
        lbl_CheckBox1.Text = CheckBox1.Checked == true ? GetGlobalResourceObject("Master", "yes").ToString() : GetGlobalResourceObject("Master", "no").ToString();
        count_fields = count_fields + 1;
        arr_divs[j] = "tr12";
        j = j + 1;
        //------------------------------------------------------no 11----------------------------------------------------------------------------
        
        if ((obj.pages_no == null || obj.pages_no.ToString() == "") && (obj.pages_from == null || obj.pages_from.ToString() == "") && (obj.pages_to == null || obj.pages_to.ToString() == ""))
        { tr13.Visible = trpages.Visible = false; }
        else
        {
         
            count_fields = count_fields + 1;
            arr_divs[j] = "tr13";
            j = j + 1;
        
           // txt_no.Text = obj.pages_no.ToString();
            txt_from.Text = obj.pages_from.ToString();
            txt_to.Text = obj.pages_to.ToString();
        }
        //--------------------------------------------------------------no 12---------------------------------------------------------------


        if ((obj_dt.organization_save == null || obj_dt.organization_save.ToString() == "") &&
          (obj_dt.country_name == null || obj_dt.country_name.ToString() == "") &&
           (obj_dt.city == null || obj_dt.city.ToString() == "") &&
           (obj_dt.save_no == null || obj_dt.save_no.ToString() == "") &&
           (obj_dt.save_notes == null || obj_dt.save_notes.ToString() == ""))
        { tr8.Visible = trsaveorg.Visible = false; }
        else
        {
            count_fields = count_fields + 1;
            arr_divs[j] = "tr8";
            j = j + 1;

            txt_org.Text = obj_dt.organization_save;
            txt_country.Text = obj_dt.country_name;
            txt_city.Text = obj_dt.city;
            txt_save_no.Text = obj_dt.save_no;
            txt_org_notes.Text = obj_dt.save_notes;
            if (obj_dt.organization_save == null || obj_dt.organization_save.ToString() == "")
            { Label21.Visible = txt_org.Visible = false; }
            if (obj_dt.country_name == null || obj_dt.country_name.ToString() == "")
            { Label22.Visible = txt_country.Visible = false; }
            if (obj_dt.city == null || obj_dt.city.ToString() == "")
            { Label23.Visible = txt_city.Visible = false; }
            if (obj_dt.save_no == null || obj_dt.save_no.ToString() == "")
            { Label24.Visible = txt_save_no.Visible = false; }
            if (obj_dt.save_notes == null || obj_dt.save_notes.ToString() == "")
            { Tr4.Visible = false; }
        }
        //--------------------------------------------------------------no 13---------------------------------------------------------------

        if (obj_dt.notes != null && obj_dt.notes != "")
        { Label14.Text = obj_dt.notes;
        count_fields = count_fields + 1;
        arr_divs[j] = "tr14";
        j = j + 1;
        }
        else { tr14.Visible = trnotes.Visible = false; }



        
        
    }

    public void changeDiv_cssClass(object sender, EventArgs e, String DivName, String ClassName)
    {
        // Find the div control as htmlgenericcontrol type, if found apply style
        System.Web.UI.HtmlControls.HtmlGenericControl div = (System.Web.UI.HtmlControls.HtmlGenericControl)Master.FindControl("ContentPlaceHolder2").FindControl(DivName);

        if (div != null)
        {
            div.Attributes.Remove("class");
            div.Attributes.Add("class", ClassName);
        }

    }
     
}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      